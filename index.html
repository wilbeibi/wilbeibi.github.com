<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="wilbeibi"><meta name="copyright" content="wilbeibi"><title>In The Direction Of Greatest Curiosity | Gradient Ascent</title><link rel="shortcut icon" href="/images/favicon.ico?v=2"><link rel="stylesheet" href="/css/index.css?version=1.9.1"><link rel="stylesheet" href="/css/custom.css?version=1.9.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"N3W10X795S","apiKey":"ed0a732eec07d11478a1d5c38c6a82b4","indexName":"wilbeibi_blog","hits":{"per_page":10},"languages":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}.","hits_stats":"${hits} results found in ${time} ms"}},
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '8.0.0'
} </script><meta name="generator" content="Hexo 8.0.0"><link rel="alternate" href="/atom.xml" title="Gradient Ascent" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">wilbeibi</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">23</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">9</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">1</span></a></div></div></div><nav id="nav" style="background-image: url(/images/curve.webp)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Gradient Ascent</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="site-info"><div id="site-title">Gradient Ascent</div><div id="site-sub-title">In The Direction Of Greatest Curiosity</div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2025/10/Prompt-Summon-Rob-Pike-to-refactor/">Prompt: Summon Rob Pike to refactor</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2025-10-29</time><div class="content"><p>I still haven’t found a good way to save my LLM prompts. For now, I’m just using Alfred’s snippet feature. Typing a few keystrokes, and it fills in a template with customizable placeholders. Here’s my codebase refactoring prompt:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">I need you to review &#123;cursor&#125; and redesign it from first principles.</span><br><span class="line"></span><br><span class="line">Before writing any code, follow these steps:</span><br><span class="line"></span><br><span class="line">1. RESEARCH &amp; UNDERSTAND (Do not skip this)</span><br><span class="line">   - Read the existing implementation thoroughly</span><br><span class="line">   - Identify what problem it&#x27;s actually solving</span><br><span class="line">   - List all the constraints and requirements</span><br><span class="line">   - Document the current architecture and dependencies</span><br><span class="line"></span><br><span class="line">   SEARCH ONLINE TO:</span><br><span class="line">   - Find how others have solved similar problems</span><br><span class="line">   - Look for established patterns and anti-patterns</span><br><span class="line">   - Research best practices for this domain</span><br><span class="line">   - Check for any canonical solutions or standards</span><br><span class="line">   - Review criticism of common approaches</span><br><span class="line">   - Find papers, blog posts, or documentation from experts like Rob Pike, Ken Thompson, or domain authorities</span><br><span class="line"></span><br><span class="line">2. QUESTION EVERYTHING</span><br><span class="line">   - What is the simplest possible solution to the core problem?</span><br><span class="line">   - Which features/abstractions are truly necessary vs. &quot;nice to have&quot;?</span><br><span class="line">   - What assumptions are we making that don&#x27;t need to be true?</span><br><span class="line">   - Can we solve this with less code, fewer dependencies, fewer concepts?</span><br><span class="line">   - What would this look like if we started from scratch today?</span><br><span class="line"></span><br><span class="line">   VERIFY YOUR ASSUMPTIONS:</span><br><span class="line">   - Search for evidence supporting or contradicting your assumptions</span><br><span class="line">   - Look for real-world performance data if optimization is claimed</span><br><span class="line">   - Check if &quot;best practices&quot; you&#x27;re following are actually justified</span><br><span class="line">   - Find counterexamples or alternative viewpoints</span><br><span class="line">   - Validate that the complexity is warranted</span><br><span class="line"></span><br><span class="line">3. DESIGN FROM FIRST PRINCIPLES</span><br><span class="line">   Apply Rob Pike&#x27;s philosophy:</span><br><span class="line">   - &quot;Less is exponentially more&quot; - Can we remove layers?</span><br><span class="line">   - &quot;Simplicity is complicated&quot; - What&#x27;s the simplest correct solution?</span><br><span class="line">   - &quot;Data dominates&quot; - Is the data structure obvious and right?</span><br><span class="line">   - &quot;If in doubt, use brute force&quot; - Are we over-optimizing?</span><br><span class="line"></span><br><span class="line">   Design principles to follow:</span><br><span class="line">   - Clear &gt; Clever</span><br><span class="line">   - Obvious &gt; Obscure</span><br><span class="line">   - Direct &gt; Indirect</span><br><span class="line">   - Simple &gt; Complex</span><br><span class="line">   - Transparent &gt; Magical</span><br><span class="line"></span><br><span class="line">   INFORMED BY RESEARCH:</span><br><span class="line">   - Compare your proposed design with what you found online</span><br><span class="line">   - Explain why simpler alternatives might work better</span><br><span class="line">   - Acknowledge tradeoffs that experts have identified</span><br><span class="line">   - Learn from others&#x27; mistakes without repeating them</span><br><span class="line"></span><br><span class="line">4. PROPOSE THE REDESIGN</span><br><span class="line">   - Describe the new design in plain language first</span><br><span class="line">   - Explain what you&#x27;re removing and why</span><br><span class="line">   - Explain what you&#x27;re keeping and why</span><br><span class="line">   - Show how it solves the core problem more directly</span><br><span class="line">   - Identify any tradeoffs honestly</span><br><span class="line">   - Reference relevant ideas or critiques you found in your research</span><br><span class="line"></span><br><span class="line">5. IMPLEMENT WITH TESTS</span><br><span class="line">   - Write tests that capture the essential behavior</span><br><span class="line">   - Implement the simplest thing that could work</span><br><span class="line">   - Use standard tools and approaches, not clever workarounds</span><br><span class="line">   - Write code that&#x27;s easy to read and understand</span><br><span class="line">   - Focus on correctness and clarity over optimization</span><br><span class="line"></span><br><span class="line">CRITICAL GUIDELINES:</span><br><span class="line">- Ruthlessly eliminate unnecessary complexity</span><br><span class="line">- Prefer boring, proven solutions over novel approaches</span><br><span class="line">- Every abstraction must earn its place</span><br><span class="line">- If you can&#x27;t explain it simply, the design is wrong</span><br><span class="line">- Make the code obvious to someone reading it for the first time</span><br><span class="line">- Stand on the shoulders of giants - learn from existing work</span><br><span class="line">- But don&#x27;t cargo-cult complexity just because &quot;everyone does it&quot;</span><br><span class="line"></span><br><span class="line">What would Rob Pike do? He&#x27;d probably delete half of it and make the rest clearer.</span><br><span class="line"></span><br><span class="line">Ready to begin the research, review, and redesign?</span><br></pre></td></tr></table></figure>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2016/07/2016-07-31-weekly3/">一周笔记</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2016-07-31</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/notes/">notes</a></span><div class="content"><h2 id="How-to-Write-a-Lisp-Interpreter-in-Python"><a href="#How-to-Write-a-Lisp-Interpreter-in-Python" class="headerlink" title="(How to Write a (Lisp) Interpreter (in Python))"></a><a href="http://norvig.com/lispy.html">(How to Write a (Lisp) Interpreter (in Python))</a></h2><p>老文章。来自Peter Norvig 的用 Python 写个 lisp 解释器。代码和解释都很完美。记得有公司出面试题出类似的，如果用这文章里的思路解决就秒杀啊。</p>
<h2 id="DNS-The-good-parts"><a href="#DNS-The-good-parts" class="headerlink" title="DNS The good parts"></a><a href="https://www.petekeen.net/dns-the-good-parts">DNS The good parts</a></h2><p>比较详细的介绍 DNS 的文章</p>
<h2 id="2016年科技阅读列"><a href="#2016年科技阅读列" class="headerlink" title="2016年科技阅读列"></a><a href="https://zhuanlan.zhihu.com/p/20472545">2016年科技阅读列</a></h2><p>一系列架构和大数据文章的集合，质量良莠不齐，偶尔也有好玩的。</p>
<h2 id="高并发性能调试经验分享"><a href="#高并发性能调试经验分享" class="headerlink" title="高并发性能调试经验分享"></a><a href="https://zhuanlan.zhihu.com/p/21348220">高并发性能调试经验分享</a></h2><p>最喜欢看这种调试的文章了，特别是这篇『在多线程和高并发环境下，如果有一个平均运行一百万次才出现一次的bug，你如何调试这个bug』，连思路带工具一路娓娓道来，非常值得一读。</p>
<h2 id="Penetration-Testing-Tools-Cheat-Sheet"><a href="#Penetration-Testing-Tools-Cheat-Sheet" class="headerlink" title="Penetration Testing Tools Cheat Sheet "></a><a href="https://highon.coffee/blog/penetration-testing-tools-cheat-sheet/">Penetration Testing Tools Cheat Sheet </a></h2><p>渗透工具 cheatsheet，初入安全的朋友可能会用得到。</p>
<h2 id="“The-Best-Programming-Advice-I-Ever-Got”-with-Rob-Pike"><a href="#“The-Best-Programming-Advice-I-Ever-Got”-with-Rob-Pike" class="headerlink" title="“The Best Programming Advice I Ever Got” with Rob Pike"></a><a href="http://www.informit.com/articles/article.aspx?p=1941206">“The Best Programming Advice I Ever Got” with Rob Pike</a></h2><p>Rob Pike 谈论 Ken Thompson 给他的编程建议：</p>
<blockquote>
<p>Ken taught me that thinking before debugging is extremely important. If you dive into the bug, you tend to fix the local issue in the code, but if you think about the bug first, how the bug came to be, you often find and correct a higher-level problem in the code that will improve the design and prevent further bugs.</p>
</blockquote>
<h2 id="The-twelve-factor-app"><a href="#The-twelve-factor-app" class="headerlink" title="The twelve-factor app"></a><a href="http://12factor.net/">The twelve-factor app</a></h2><p>从 Two Scoop of Django 上看来，有点类似写 app 的 best practices.</p>
<h2 id="The-Product-Managers’-Guide-to-Continuous-Delivery-and-DevOps"><a href="#The-Product-Managers’-Guide-to-Continuous-Delivery-and-DevOps" class="headerlink" title="The Product Managers’ Guide to Continuous Delivery and DevOps"></a><a href="http://www.mindtheproduct.com/2016/02/what-the-hell-are-ci-cd-and-devops-a-cheatsheet-for-the-rest-of-us">The Product Managers’ Guide to Continuous Delivery and DevOps</a></h2><p>简单介绍什么是 Continuous Delivery 和 DevOps。</p>
<h2 id="ResysChina"><a href="#ResysChina" class="headerlink" title="ResysChina"></a><a href="https://zhuanlan.zhihu.com/resyschina">ResysChina</a></h2><p>着重推荐算法文章的高质量知乎专栏</p>
<h2 id="Real–world-HTTP-2-400gb-of-images-per-day"><a href="#Real–world-HTTP-2-400gb-of-images-per-day" class="headerlink" title="Real–world HTTP&#x2F;2: 400gb of images per day"></a><a href="https://99designs.com/tech-blog/blog/2016/07/14/real-world-http-2-400gb-of-images-per-day/">Real–world HTTP&#x2F;2: 400gb of images per day</a></h2><p>也是 debug 类的好网站。一个图片分享网站讲他们迁移到 HTTP&#x2F;2 的性能提升和坑。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2016/06/2016-06-05-weekly2/">一周笔记</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2016-06-05</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/notes/">notes</a></span><div class="content"><h2 id="The-Software-Development-Poverty-Trap"><a href="#The-Software-Development-Poverty-Trap" class="headerlink" title="The Software Development Poverty Trap"></a><a href="http://alexandros.resin.io/the-software-development-poverty-trap/?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website">The Software Development Poverty Trap</a></h2><p>软件开发中的马太效应，越是差劲的团队越缺乏长期规划，用老旧的技术，写 ad-hoc 的代码，优秀的工程师越容易离开（斜眼看我司）。</p>
<h2 id="“把程序写好”这回事"><a href="#“把程序写好”这回事" class="headerlink" title="“把程序写好”这回事"></a><a href="http://mp.weixin.qq.com/s?__biz=MzA3MDMwOTcwMg==&mid=2650004561&idx=1&sn=967c3816e3b0993b5517799183efb3be&scene=0#rd">“把程序写好”这回事</a></h2><p>来此余晟的微信公共号（对，就是翻译正则表达式的那哥们）。很多程序员在学校和工作中编程，但不知道如何写好程序，貌似也没有学校教如何『写好程序』。写好程序绝不是编译通过，跑过测试，符合 coding style 那么简单。文中提到的『荣誉感』还是挺重要的，我写代码的时候就会想着对自己的每一行代码负责，通过 code review 看别人的代码质量也会潜移默化影响我对这个人的评价，和对待他的态度。</p>
<h2 id="What-every-programmer-should-know-about-memory"><a href="#What-every-programmer-should-know-about-memory" class="headerlink" title="What every programmer should know about memory"></a><a href="https://www.akkadia.org/drepper/cpumemory.pdf">What every programmer should know about memory</a></h2><p>挺长的，从偏硬件的角度讲解内存的原理。前面几章在各个 OS 教科书上都能找到，后面的内容就比较贴近现实，看着很有意思。</p>
<h2 id="The-Little-Manual-of-API-Design"><a href="#The-Little-Manual-of-API-Design" class="headerlink" title="The Little Manual of API Design"></a><a href="http://people.mpi-inf.mpg.de/~jblanche/api-design.pdf">The Little Manual of API Design</a></h2><p>记得 GoogleTechTalk 里著名的一集 <a href="https://www.youtube.com/watch?v=aAb7hSCtvGw">How To Design A Good API and Why it Matters</a> 么，这个 manual 可以看作那个 talk 的扩展读物。API Design 在程序设计中的重要性相比于架构不遑多让，看看这些 best practices 有益身心~~</p>
<h2 id="What-Powers-Instagram-Hundreds-of-Instances-Dozens-of-Technologies"><a href="#What-Powers-Instagram-Hundreds-of-Instances-Dozens-of-Technologies" class="headerlink" title="What Powers Instagram: Hundreds of Instances, Dozens of Technologies"></a><a href="http://instagram-engineering.tumblr.com/post/13649370142/what-powers-instagram-hundreds-of-instances?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website">What Powers Instagram: Hundreds of Instances, Dozens of Technologies</a></h2><p>一篇老文章，介绍 Instagram 早期时候（2012）的架构。我最喜欢这种早期架构的文章，看别人在高速增长期如何用快糙猛的方法解决问题。里面给的小部分技术在今天看来有些过时了，但大部分还很有借鉴意义。比如提到的 gunicorn 和 Fabric，是 Python  web 开发中的标配（还有 supervisor）；vmtouch （查了下发现是一个超级light weight的内存数据管理工具，代码也写的很棒）；Munin，Pingdom  监控，Sentry 报告错误。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2016/05/2016-05-21-weekly1/">一周笔记</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2016-05-21</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/notes/">notes</a></span><div class="content"><h2 id="第二周"><a href="#第二周" class="headerlink" title="第二周"></a>第二周</h2><p>这周 RSS 里没啥非常好的文章，就把以前的笔记里翻出来几篇凑数。</p>
<h2 id="Elevate-yourself-with-side-projects"><a href="#Elevate-yourself-with-side-projects" class="headerlink" title="Elevate yourself with side projects"></a><a href="https://slackhq.com/elevate-yourself-with-side-projects-acbc43229422#.12qjef3av">Elevate yourself with side projects</a></h2><p>爱因斯坦的在专利局工作时候的 side project 是相对论论文，学校门卫波洛克（对，现代艺术甩泥点子那位）的 side project 是画画，Slack 一开始也是游戏公司的 side project 聊天工具。Side project 能真正有效促进一个人的专业进步（深有同感）。不是有句话说么，这年头在湾区没有一两个 side project 都不好意跟人打招呼。</p>
<h2 id="What-every-computer-science-major-should-know"><a href="#What-every-computer-science-major-should-know" class="headerlink" title="What every computer science major should know"></a><a href="http://matt.might.net/articles/what-cs-majors-should-know/">What every computer science major should know</a></h2><p>压箱底的老文章。 知名博主 Matt Might的一篇长文，很详细的列出了一个合格的 CS 学生应该学习和掌握的知识，任何一个学 CS 的学生都应该看看这篇文章。</p>
<h2 id="Peer-Code-Reviews-At-Loose-Cannon"><a href="#Peer-Code-Reviews-At-Loose-Cannon" class="headerlink" title="Peer Code Reviews At Loose Cannon"></a><a href="http://scottbilas.com/blog/peer-code-reviews-at-loose-cannon/">Peer Code Reviews At Loose Cannon</a></h2><p>技术博客大多谈的是如何学习新技术，如何设计架构，如何找工作，却很少谈如何正确的 Code Review 的。Code Review 在工作中非常重要，是有效的学习&#x2F;分享知识，增进办公室人际关系的途径。这一系列文章就很详细的谈了如何 Code Review。附赠这篇 <a href="http://www.kevinlondon.com/2015/05/05/code-review-best-practices.html">Code Review Best Practices</a>。</p>
<h2 id="香草冰淇淋，世界末日与烧鹿骨"><a href="#香草冰淇淋，世界末日与烧鹿骨" class="headerlink" title="香草冰淇淋，世界末日与烧鹿骨"></a><a href="http://chuansong.me/n/123723">香草冰淇淋，世界末日与烧鹿骨</a></h2><p>这是一篇我很喜欢的非技术文章。从顾客离奇的投诉『新车会对香草冰淇淋过敏』说起，分析了一些显式因果关系和其背后看似荒诞的理性依据。原文链接已经失效，给的链接是别的网站转的。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2016/05/2016-05-16-weekly0/">一周笔记</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2016-05-16</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/notes/">notes</a></span><div class="content"><h2 id="什么是一周笔记"><a href="#什么是一周笔记" class="headerlink" title="什么是一周笔记"></a>什么是一周笔记</h2><p>这是经女朋友提醒，准备每周一篇，阅读的技术博客，文章等的简短评论，干货收集，读书感想及各种好玩的事儿。</p>
<h2 id="模仿-O’Reilly-风格插图"><a href="#模仿-O’Reilly-风格插图" class="headerlink" title="模仿 O’Reilly 风格插图"></a>模仿 O’Reilly 风格插图</h2><p>一直觉得O’Reilly书系的示意图简洁美观，希望写博客或者presentation的时候也能用，今天花时间查了下，字体用的是 Myriad，编程字体用的是 Ubuntu Mono，用 Keynote 画了几个简单的图形，供日后使用。</p>
<p><img src="http://i.imgur.com/Iqq2QFG.png"></p>
<h2 id="Questions-to-ask-your-interviewer"><a href="#Questions-to-ask-your-interviewer" class="headerlink" title="Questions to ask your interviewer"></a><a href="https://rkoutnik.com/articles/Questions-to-ask-your-interviewer.html">Questions to ask your interviewer</a></h2><p>每次面试时候最后面试官都会问 “Do you have any questions?”，然后大多数人都只是问一些隔靴搔痒的问题，这篇文章比较深入的探讨这个问题，怎样让问面试官问题成为你的加分点，哪些问题能反映出这个公司的开发流程和工程师文化（关系到是否值得加入），面试必备的好问 （Victoria 同学翻译成了<a href="http://victoriahong.com/2016/05/question-to-ask-your-interviewer-translation/">中文</a>）。</p>
<h2 id="Cron-best-practices"><a href="#Cron-best-practices" class="headerlink" title="Cron best practices"></a><a href="https://sanctum.geek.nz/arabesque/cron-best-practices/">Cron best practices</a></h2><p>Cron通常用来每隔一段时间跑一个脚本，但大多数人都只是用来检查重启服务器或者备份。本文介绍了一些 Cron 的高级玩法，输出错误码，发送邮件，设置 timeout，等等。BTW，这个作者还有一些 Linux Crypto 的文章，也很值得一看。</p>
<h2 id="Choosing-a-Linux-Tracer"><a href="#Choosing-a-Linux-Tracer" class="headerlink" title="Choosing a Linux Tracer"></a><a href="http://www.brendangregg.com/blog/2015-07-08/choosing-a-linux-tracer.html">Choosing a Linux Tracer</a></h2><p>介绍了一堆Performance monitoring &amp; tunning 的工具，来自 Netflix senior performance architect。我查 systemtap 的时候翻到这哥们的博客，发现此人文章很棒，然后和我们司的performance engineer 聊文章中的问题，发现这博主是他当年在 Sun 的同事 … …</p>
<h2 id="Latency-Numbers-Every-Programmer-Should-Know"><a href="#Latency-Numbers-Every-Programmer-Should-Know" class="headerlink" title="Latency Numbers Every Programmer Should Know"></a><a href="https://gist.github.com/jboner/2841832">Latency Numbers Every Programmer Should Know</a></h2><p>这个介绍不同存储器性能的表格历史悠久，这个 gist 及其评论里很多人贡献了他们知道的相关的文档和视频，很多都很有意思。一些常用的还是很有必要背下来的（比如 CPU， 内存，硬盘， SSD 读取速度的倍数关系），对于初学编程的人能更好的了解 <a href="https://www.wikiwand.com/en/Locality_of_reference">locality</a> 的重要性。</p>
<h2 id="保证分布式系统数据一致性的6种方案"><a href="#保证分布式系统数据一致性的6种方案" class="headerlink" title="保证分布式系统数据一致性的6种方案"></a><a href="http://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&mid=2653546976&idx=1&sn=c3fb2338389a41e7ab998c0c21bd3e5d&scene=2&srcid=0419sWSVDrJ1czLxPzOdEyak&from=timeline&isappinstalled=0#wechat_redirect">保证分布式系统数据一致性的6种方案</a></h2><p>介绍了一些国内的案例，文末的链接也挺好的。</p>
<h2 id="浅谈-WHR-全历史排名"><a href="#浅谈-WHR-全历史排名" class="headerlink" title="浅谈 WHR 全历史排名"></a><a href="http://blog.codingnow.com/2016/03/whr.html#more">浅谈 WHR 全历史排名</a></h2><p>云风的文章和他的代码一样，一向以信噪比高著称。这是一篇谈博弈中的打分算法问题的，文中谈到elo就是电影《社交网络》中 Eduardo 在窗户上写的公式。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2016/01/plan/">2016 年计划</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2016-01-01</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/writing/">writing</a></span><div class="content"><h1 id="2016-新年计划"><a href="#2016-新年计划" class="headerlink" title="2016 新年计划"></a>2016 新年计划</h1><p>一如既往的，新年是要计划的，实不实现再两说。</p>
<h2 id="2015-的计划回顾"><a href="#2015-的计划回顾" class="headerlink" title="2015 的计划回顾"></a>2015 的计划回顾</h2><ul>
<li>第一条计划算实现了四成，八九月份找到工作了。</li>
<li>第二条读书计划，毫无疑问轻松达成。</li>
<li>第三条写博客计划，额，可耻地没做到。</li>
<li>第四条掌握 Haskell 计划，算是搞定了。</li>
<li>第五条计划，今年继续~~</li>
</ul>
<h2 id="今年的计划"><a href="#今年的计划" class="headerlink" title="今年的计划"></a>今年的计划</h2><ul>
<li>写一个有分量的开源项目，或者写个库放上 pypi 之类的。</li>
<li>学一门手艺，摄影，跑酷，弹贝斯，篆刻或者其他什么的。</li>
<li>健身。因为练的无氧，这不好量化。以后再加具体的目标。</li>
<li>读书就不列了，一直没撂下。写博客，一周至少一篇。</li>
<li>继续找女朋友~</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2015/05/2015-05-09-K_edit_distances/">找出编辑距离不大于 K 的单词</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2015-05-09</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/algorithms/">algorithms</a></span><div class="content"><h1 id="关于-edit-distance-的一道题"><a href="#关于-edit-distance-的一道题" class="headerlink" title="关于 edit distance 的一道题"></a>关于 edit distance 的一道题</h1><p>最近看到一个很有意思的面试题：给一个单词和一个字典，找出字典中所有和给定单词编辑距离不大于 k 的词。</p>
<p>一个常见的思路是遍历一遍，求单词和字典中每一项的编辑距离。我们知道编辑距离是二维 DP，时间复杂度为 $O(L^2)$，其中 L 为每个单词平均长度，则总时间复杂度为$O(NL^2)$， N 为字典中词的个数。</p>
<p>这个方法的问题在于，一旦查询单词变多，性能会很糟糕。基于<a href="http://www.zhihu.com/question/29592463">知乎 Lee Shellay的回答</a>，可以通过构造 Trie， 结合 DFS，来解决这个问题。</p>
<p>所以算法思路并不难：  </p>
<ol>
<li>根据字典中的单词构造前缀树，标记每个单词结束时的结束符为 ’$’。  </li>
<li>设计函数 API 为<code>check_fuzzy(trie, word, path, tol)</code>。<code>trie</code>是在树中当前走到的节点，<code>word</code> 表示走到当前节点剩余需要处理的查询单词，<code>path</code>表示走到当前节点已经记录的字典单词前缀，<code>tol</code> 表示剩余可容忍的编辑距离。然后定义一个set，不断找到可能的单词并入这个set，直到结束。<br>  所以，函数只在<code>tol</code> 为0时候终止（为什么不是<code>word</code>为空时候终止？因为有可用的编辑距离都用在增加后缀的情况）。</li>
</ol>
<ul>
<li>匹配当前字符，有两种情况：匹配，那么直接递归下一层；不匹配，可能是字母不一致或者是 word 已经结束（这个情况很容易被忽略），需要 tol 减一后递归下一层。</li>
<li>增加任意字母（字典单词比查询单词多字母）。这里和知乎回答里的不一样，那里是枚举了26个字母，其实只要枚举当前 tree 的所有节点字母就行了（Jayxon 大牛想到的）。</li>
<li>删除字符。word 向后移一个字母，tol 减一。</li>
</ul>
<p>最后代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Based on Lee Shellay&#x27;s code http://www.zhihu.com/question/29592463</span></span><br><span class="line"></span><br><span class="line">END = <span class="string">&#x27;$&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_trie</span>(<span class="params">words</span>):</span><br><span class="line">    trie = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> words:</span><br><span class="line">        t = trie</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> word:</span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> t:</span><br><span class="line">                t[c] = &#123;&#125;</span><br><span class="line">            t = t[c]</span><br><span class="line">        t[END] = &#123;&#125;</span><br><span class="line">    <span class="keyword">return</span> trie</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_fuzzy_v4</span>(<span class="params">trie, word, path = <span class="string">&#x27;&#x27;</span>, tol = <span class="number">1</span></span>):</span><br><span class="line">    <span class="keyword">if</span> tol &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line">    ps = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">if</span> word == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> END <span class="keyword">in</span> trie:</span><br><span class="line">             ps = &#123;path&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> trie:</span><br><span class="line">        <span class="comment"># match current or mark as substition</span></span><br><span class="line">        ps |= check_fuzzy_v4(trie[k], word[<span class="number">1</span>:], path+k, tol - (<span class="keyword">not</span> word <span class="keyword">or</span> k != word[<span class="number">0</span>]))</span><br><span class="line">        <span class="comment"># add random char</span></span><br><span class="line">        ps |= check_fuzzy_v4(trie[k], word, path+k, tol-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># delete one (if word is empty, word[2:] will not report error)</span></span><br><span class="line">    ps |= check_fuzzy_v4(trie, word[<span class="number">1</span>:], path, tol-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> ps</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    words = [<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;hela&#x27;</span>, <span class="string">&#x27;hel&#x27;</span>, <span class="string">&#x27;dokm&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;ke&#x27;</span>, <span class="string">&#x27;ik&#x27;</span>]</span><br><span class="line">    t = make_trie(words)</span><br><span class="line">    <span class="built_in">print</span> check_fuzzy_v4(t, <span class="string">&#x27;helo&#x27;</span>,<span class="string">&#x27;&#x27;</span>, tol=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>然后试试大一点的数据。我们知道在<code>/usr/share/dict/words</code>存着拼写检查的单词表，一共 2.4M 共 235886个单词（至少在我的 Mac 上是这么多）。可以用它来构造字典 <code>cat /usr/share/dict/words &gt; ./words.txt</code>。然后把一句话改的乱七八糟，用代码来跑跑试试：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    origin = <span class="string">&quot;For you know only a heap of broken images&quot;</span></span><br><span class="line">    modified = <span class="string">&quot;Far your knn onlie a deep of borken iimaes&quot;</span></span><br><span class="line"></span><br><span class="line">    words_list = [line.strip() <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">&#x27;words.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)]</span><br><span class="line">    tree = make_trie(words_list)</span><br><span class="line">    <span class="keyword">for</span> w <span class="keyword">in</span> modified.split():</span><br><span class="line">        <span class="built_in">print</span> check_fuzzy_v4(tree, w, tol=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>结果也挺快的:</p>
<ul>
<li>CPython: 2.53s user 0.25s system 50% cpu 5.470 total</li>
<li>Pypy: 1.63s user 0.19s system 43% cpu 4.186 total</li>
</ul>
<p>就是这样,  喵~</p>
<p>PS: Lee Shellay回答又更新了，提升了性能和准确度，代码比我这的好，欢迎去看。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2015/03/2015-03-02-coroutine-producer-comsumer/">Producer consumer problem in coroutine</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2015-03-02</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/python/">python</a></span><div class="content"><h2 id="What-is-coroutine"><a href="#What-is-coroutine" class="headerlink" title="What is coroutine"></a>What is coroutine</h2><p>As the name implies, coroutine refers to co-operative routine. It allows you to suspending and resuming execution at different locations. So, it’s essentially just context switching. Not surprisingly, coroutine is implemented in primitives like setjmp&#x2F;longjump or ucontext in low level.</p>
<p>In many senarioes, coroutine is a more light-weight alternative of threads. For programming languages with GIL (like Python), coroutine would used to handle concurrency.</p>
<h2 id="Producer-and-consumer-problem"><a href="#Producer-and-consumer-problem" class="headerlink" title="Producer and consumer problem"></a>Producer and consumer problem</h2><p>Let’s take a look at classic “producer-consumer” problem. At each time, one coroutine produce products and add them into queue, the other coroutine take products from queue and use it (hmm, sounds like video buffering, right?). </p>
<p>The code below assumes you already have some knowledge of generator.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">coroutine</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="comment"># A wrapper to convert function into generator</span></span><br><span class="line">    <span class="comment"># From David Beazley</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">*args,**kwargs</span>):</span><br><span class="line">        cr = func(*args,**kwargs)</span><br><span class="line">        cr.<span class="built_in">next</span>()</span><br><span class="line">        <span class="keyword">return</span> cr</span><br><span class="line">    <span class="keyword">return</span> start  </span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">producer</span>(<span class="params">target</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        data = random.randint(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;# producer: sending data &#123;&#125;&quot;</span>.<span class="built_in">format</span>(data))</span><br><span class="line">        target.send(data)</span><br><span class="line">        </span><br><span class="line"><span class="meta">@coroutine</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">consumer</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = <span class="keyword">yield</span></span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;# consumer: receving data &#123;&#125;&quot;</span>.<span class="built_in">format</span>(data))</span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    g_consumer = consumer()</span><br><span class="line">    producer(g_consumer)</span><br></pre></td></tr></table></figure>
<p>Simple enough, <code>send()</code> is a built-in function of generator. The producer send data to consumer, consumer receives data from <code>yield</code>.</p>
<h2 id="Coroutine-usage"><a href="#Coroutine-usage" class="headerlink" title="Coroutine usage"></a>Coroutine usage</h2><p>Yes, the famous concurrency library gevent is based on coroutine.</p>
<h2 id="Reference-and-Recommended-Reading"><a href="#Reference-and-Recommended-Reading" class="headerlink" title="Reference and Recommended Reading:"></a>Reference and Recommended Reading:</h2><p><a href="https://www.python.org/dev/peps/pep-0342/">PEP 342: Coroutines via Enhanced Generators</a></p>
<p><a href="http://coolshell.cn/articles/10975.html">一个“蝇量级” C 语言协程库</a></p>
<p><a href="http://learn-gevent-socketio.readthedocs.org/en/latest/general_concepts.html">General concepts: concurrency, parallelism, threads and processes</a></p>
<p><a href="http://www.dabeaz.com/coroutines/">A Curious Course on Coroutines and Concurrency</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2015/02/2015-02-17-colorize-log/">Colorizing Loggers -- A simple practice of decorator</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2015-02-18</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/python/">python</a></span><div class="content"><h2 id="What-is-this-post-about"><a href="#What-is-this-post-about" class="headerlink" title="What is this post about"></a>What is this post about</h2><p>Many people believe that decorator is one of the obscure concepts in Python.<br>Trust me, it is not. To be short, <strong>a decorator is a function that modifies other<br>functions via closures.</strong></p>
<p>They are plenty detailed articles about what decorator it is so there is no need to write one more. If you are not familiar with it, you may want to check these:</p>
<ul>
<li><p><a href="http://sahandsaba.com/python-decorators.html">A Study of Python’s More Advanced Features Part II: Closures, Decorators and functools</a></p>
</li>
<li><p><a href="https://realpython.com/blog/python/primer-on-python-decorators/#.UvQEs0JdUwJ">Primer on Python Decorators</a></p>
</li>
</ul>
<p>In this article, I am going to use a simple but interesting example to show</p>
<ul>
<li>how to colorize the output in command line</li>
<li>how to implement a switch case in Python (Python does not have built-in switch case)</li>
<li>a decorator with parameters</li>
</ul>
<p>OK, let’s rock.</p>
<h2 id="colorize-your-text"><a href="#colorize-your-text" class="headerlink" title="colorize your text"></a>colorize your text</h2><p>There is a set of escape sequences used to change the color of texts. So if we want to colorize a sentence, we just need to put the sentence between the color escape sequence and reset escape sequence. For example:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; ORANGE = <span class="string">&#x27;\033[33m&#x27;</span></span><br><span class="line">&gt;&gt; RED = <span class="string">&#x27;\033[31m&#x27;</span></span><br><span class="line">&gt;&gt; GREEN = <span class="string">&#x27;\033[32m&#x27;</span></span><br><span class="line">&gt;&gt; BLUE = <span class="string">&#x27;\033[34m&#x27;</span></span><br><span class="line">&gt;&gt; RESET = <span class="string">&#x27;\033[0m&#x27;</span></span><br><span class="line">&gt;&gt; <span class="built_in">print</span> ORANGE + <span class="string">&quot;Chinese New Year&quot;</span> + RESET</span><br><span class="line">&gt;&gt; <span class="built_in">print</span> GREEN + <span class="string">&quot;Chinese&quot;</span> + GREEN + <span class="string">&quot;New&quot;</span> + BLUE + <span class="string">&quot;Year&quot;</span> + RESET</span><br></pre></td></tr></table></figure>
<p>You will see<br><font style="font-family: courier;" color="orange">Chinese New Year</font></p>
<p>and<br><font style="font-family: courier;" color="red">Chinese </font><font style="font-family: courier;" color="green">New </font><font style="font-family: courier;" color="blue">Year</font></p>
<h2 id="How-to-choose-the-color-in-code"><a href="#How-to-choose-the-color-in-code" class="headerlink" title="How to choose the color in code"></a>How to choose the color in code</h2><p>As I said, Python does not support switch case. So we cannot switch the color name and choose the corresponding escaped sequence. Fortunately, dictionary would do the work.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">getColor</span>(<span class="params">color</span>):</span><br><span class="line">    <span class="comment"># @param color: string like &quot;red&quot; or &quot;yellow&quot;</span></span><br><span class="line">    <span class="comment"># @return the corresponding escape sequence.</span></span><br><span class="line">    <span class="comment"># If not valid, return empty string</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">    RED = <span class="string">&#x27;\033[31m&#x27;</span>,</span><br><span class="line">    GREEN = <span class="string">&#x27;\033[32m&#x27;</span>,</span><br><span class="line">    BLUE = <span class="string">&#x27;\033[34m&#x27;</span>,</span><br><span class="line">    <span class="comment"># and more ...</span></span><br><span class="line">    ORANGE = <span class="string">&#x27;\033[33m&#x27;</span></span><br><span class="line">    &#125;.get(color, <span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>The trick is, the dictionary’s built in <code>get</code> method. The first parameter here is key, the second optional parameter is default. As the docstring shows:</p>
<blockquote>
<p>D.get(k[,d]) -&gt; D[k] if k in D, else d.  d defaults to None.</p>
</blockquote>
<h2 id="Use-the-decorator"><a href="#Use-the-decorator" class="headerlink" title="Use the decorator"></a>Use the decorator</h2><p>Suppose we have a function to implement a task. It may has three kind of return string, if task is completed successfully, it returns “SUCCESS: blah blah …”, if the task is finished but we cannot ensure it’s corretness, it returns “WARNING: blah blah …”, if task failed, returns “ERROR: blah blah …”, how do we colorize these return strings?</p>
<p><a href="https://gist.github.com/Wilbeibi/a2ac59f211bcd681d007">Raw code</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">colorize</span>(<span class="params">*args</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getColor</span>(<span class="params">color</span>):</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;black&#x27;</span> : <span class="string">&#x27;\033[30m&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;red&#x27;</span> : <span class="string">&#x27;\033[31m&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;green&#x27;</span> : <span class="string">&#x27;\033[32m&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;orange&#x27;</span> : <span class="string">&#x27;\033[33m&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;blue&#x27;</span> : <span class="string">&#x27;\033[34m&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;purple&#x27;</span> : <span class="string">&#x27;\033[35m&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;cyan&#x27;</span> : <span class="string">&#x27;\033[36m&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;light_grey&#x27;</span> : <span class="string">&#x27;\033[37m&#x27;</span></span><br><span class="line">        &#125;.get(color, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_colorize</span>():</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">wrapper</span>():</span><br><span class="line">            RESET = <span class="string">&#x27;\033[0m&#x27;</span></span><br><span class="line">            text = func()</span><br><span class="line">            <span class="comment">#if not isinstance(text, basestring):</span></span><br><span class="line">            <span class="comment">#    text = str(text)</span></span><br><span class="line">            level = text.split(<span class="string">&#x27;:&#x27;</span>, <span class="number">1</span>)[<span class="number">0</span>]</span><br><span class="line">            color = &#123;</span><br><span class="line">                <span class="string">&#x27;SUCCESS&#x27;</span>: args[<span class="number">0</span>],</span><br><span class="line">                <span class="string">&#x27;WARNING&#x27;</span>: args[<span class="number">1</span>],</span><br><span class="line">                <span class="string">&#x27;ERROR&#x27;</span>: args[<span class="number">2</span>]</span><br><span class="line">            &#125;.get(level, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&#123;0&#125;&#123;1&#125;&#123;2&#125;&quot;</span>.<span class="built_in">format</span>(getColor(color), text, RESET)</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line">    <span class="keyword">return</span> _colorize</span><br><span class="line"></span><br><span class="line"><span class="meta">@colorize(<span class="params"><span class="string">&quot;green&quot;</span>, <span class="string">&quot;orange&quot;</span>, <span class="string">&quot;red&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do_task</span>():</span><br><span class="line">    <span class="comment"># working working ....</span></span><br><span class="line">    <span class="keyword">if</span> (success):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;SUCCESS: Yeah~~&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> (warning):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;WARNING: wait, what?&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ERROR: something went wrong here.&quot;</span></span><br></pre></td></tr></table></figure>

<p>As you can tell, to make the decorator with parameters, we need to put it in another decorator.</p>
<p>Decorator are often used as cache, profiler, logger, synchronization(acquire lock, drop lock) and so forth. One of my favourite library <a href="http://click.pocoo.org/3/">Click</a> is also a wonderful example.</p>
<p>Happy Chinese New Year ~</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2015/02/2015-02-12-2D-pointer/">How to delete nodes of linked list with pointers-to-pointers (Chinese)</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2015-02-12</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/algorithms/">algorithms</a></span><div class="content"><p>我在用C++写 Leetcode中 Remove duplicates from linked list II 一题时，看到别人的一份代码，感觉写法很有趣，细细研究了一下。受益不少。</p>
<p>在大部分链表题中，我们习惯于创建一个空节点dummy，使之指向链表的头结点，以方便对<br>第一个节点进行操作（比如，删除它）。最后答案返回dummy.next。比较有节操的同学会在<br>删除链表的某些节点时用delete，以免内存泄露，但是难道就没有考虑过dummy节点感受么？</p>
<p>使用一个二维指针，可以优雅的解决了这个问题。</p>
<p>举个简单的🌰：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Suppose we have a linked list &quot;1-&gt;2-&gt;3&quot;, we want to delete the    </span></span><br><span class="line"><span class="comment"> * second node, remains &quot;1-&gt;3&quot;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">ListNode **p = &amp;head, *succ;</span><br><span class="line">p = &amp;(*p)-&gt;next;</span><br><span class="line">succ = (*p)-&gt;next;</span><br><span class="line"><span class="built_in">delete</span> (*p);</span><br><span class="line">(*p) = succ;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p>尝试解释一下下。<code>p</code>是一个二级指针，也就是说，在一开始，<code>p</code>是一个指向一个指向<code>head</code>指针的指针（也就是<code>(*p)</code>指向<code>head</code>）。这样的好处就是，当我们需要在某一个时刻删除指向的节点（<code>delete *p</code>操作），p本身不受影响（当然，是p指向的指针所对应的内存空间被释放了）。唯一一点不方便的时，其他每次移动的时候，都要用<code>(*p)</code>（p淡淡的看着他指向的指针往后移。）</p>
<p>和用dummy解法不同的是，dummy解法指针后移是<code>ptr = ptr-&gt;next;</code>。那我们这呢？<code>(*p) = (*p)-&gt;next;</code>？这样是错的。比如<code>1-&gt;2</code>里从<code>1</code>移动到<code>2</code>的过程中，就把节点<code>1</code>修改了。所以，要移动的是p。即为<code>p = &amp;(*p)-&gt;next</code>，其中<code>-&gt;</code>的优先级是高于<code>&amp;</code>的，把p赋值为<code>(*p)-&gt;</code>的地址，所以现在<code>(*p)</code>指向老<code>(*p)</code>的next。</p>
<p>另一个大家可能关心的问题，在<code>delete (*p)</code>后，<code>(*p)</code>的前驱节点的next是怎么不找丢的呀？这其实涉及到<code>delete</code>的本质（Stackoverflow对这个问题有个不错的<a href="http://stackoverflow.com/a/11603084/1035859">回答</a>）。当我们调用<code>delete</code>的时候，那块内存里的数据其实并没有消失，只是这块内存地址被标记为可以利用，当之后的程序需要new的时候，才有可能覆盖掉这里的数据。就像爱情，没有一段新的覆盖，老的怎么忘的掉（情人节了还在改博客，唉~~）。所以这个代码严格意义上说是由风险的，如果在delete的一瞬间，正好另一个程序&#x2F;进程new了一块内存，又刚好是这里，这个方法就废了。fix的方法就是delete前，赋给一个临时变量，把next覆盖当前，再delete临时变量。</p>
<p>修改的过程中，发现陈皓也写过<a href="http://coolshell.cn/articles/8990.html">类似的文章</a>，这个trick被Linus举例为什么才是core low-level coding，真正懂指针的做法。 他的文章还有配图，如果我表述的还是没让大家理解，推荐去读一下。</p>
<p>PS：《Pointers In C》的第十二章《Using Structures and Pointers》，也有关于指针链表操作的详细解释。</p>
<p><img src="http://ecx.images-amazon.com/images/I/51A8TNWQ3BL.jpg"></p>
</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(/images/curve.webp)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2025 By wilbeibi</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.1"></script><script src="/js/fancybox.js?version=1.9.1"></script><script src="/js/sidebar.js?version=1.9.1"></script><script src="/js/copy.js?version=1.9.1"></script><script src="/js/fireworks.js?version=1.9.1"></script><script src="/js/transition.js?version=1.9.1"></script><script src="/js/scroll.js?version=1.9.1"></script><script src="/js/head.js?version=1.9.1"></script><script src="/js/search/algolia.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>